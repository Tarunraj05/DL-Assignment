import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn import datasets
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score, classification_report

class PerceptronModel:
    def __init__(self, learning_rate=0.1, max_iter=500):
        self.learning_rate = learning_rate
        self.max_iter = max_iter
        self.weights = None
        self.bias = None
    
    def fit(self, X, y):
        # Initialize weights randomly
        self.weights = np.random.randn(X.shape[1])
        self.bias = np.random.randn()
        
        print(f"Initial weights: {self.weights}")
        print(f"Initial bias: {self.bias}")
        
        for _ in range(self.max_iter):
            for i in range(X.shape[0]):
                z = np.dot(X[i], self.weights) + self.bias
                y_pred = 1 if z >= 0 else 0
                update = self.learning_rate * (y[i] - y_pred)
                self.weights += update * X[i]
                self.bias += update
        
        # Print final weights and bias
        print(f"Final weights: {self.weights}")
        print(f"Final bias: {self.bias}")
    
    def predict(self, X):
        return np.array([1 if np.dot(x, self.weights) + self.bias >= 0 else 0 for x in X])
        
# Load the Iris dataset
iris = datasets.load_iris()
X = iris.data[:, :2]  # Use only sepal length and sepal width
y = (iris.target != 0).astype(int)  # Convert to binary classification (Setosa vs. Non-Setosa)

# Convert to DataFrame for visualization
df = pd.DataFrame(X, columns=['Sepal Length', 'Sepal Width'])
df['Species'] = y

# Data visualization
sns.pairplot(df, hue='Species', diag_kind='kde')
plt.show()

# Split data into training and testing sets
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# Create a Perceptron classifier
clf = PerceptronModel(learning_rate=0.1, max_iter=1000)  # Fixed class name and parameter

# Train the model
clf.fit(X_train, y_train)

# Make predictions
y_pred = clf.predict(X_test)

# Evaluate the model
accuracy = accuracy_score(y_test, y_pred)
report = classification_report(y_test, y_pred, target_names=['Setosa', 'Non-Setosa'])

print(f'Accuracy: {accuracy:.2f}')
print('Classification Report:\n', report)
